---
title: 'OHI 2020: Natural Products: Ornamentals data prep'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '../../../workflow/templates/ohi_hdr.html'
  pdf_document:
    toc: true
---

[REFERENCE RMD FILE: http://ohi-science.org/ohiprep_v2020/globalprep/np/v2020/np_dataprep.html]

# Summary
This analysis converts FAO mariculture data into one of the data layers used to calculate OHI 2020 global natural products (NP) scores. We will conduct the overall NP data prep on seaweeds, fish oil/fish meal (FOFM), and ornamentals, however, our final layer from this data prep will only consist of seaweeds.

# Updates from previous assessment
Instead of using all NP commodity categories (seaweed, FOFM, coral, sponge, and ornamentals), we are only prepping seaweeds in this data prep. Overall, we are excluding corals, shells, and sponges from our calculations for the NP goal. FOFM is calcualted from Watson fisheries data, seaweed production are calculated from FAO mariculture datasets, while ornamentals production is calculated from FAO commodities datasets. New year of FAO mariculture data (1950-2018). 

***

# Data Source 

## Production data

**Reference**:      
http://www.fao.org/fishery/statistics/software/fishstatj/en#downlApp
Release date: March 2019
FAO Global Aquaculture Production Quantity 1950_2018
FAO metadata found [here](http://www.fao.org/fishery/statistics/global-aquaculture-production/en)

**Downloaded**: 5/11/2020

**Description**:  Quantity (tonnes) of mariculture for each country, species, year.

**Time range**: 1950-2018 

## Seafood Watch sustainability data

**Reference**: 
https://www.seafoodwatch.org/-/m/sfw/pdf/whats%20new/complete%20recommendation%20list.pdf
Release date: August 3, 2020

**Downloaded**: July 22, 2020

**Description**: Monterey Bay Aquarium Seafood Watch aquaculture recommendations. Sustainability scored from 0-10. Rescaled to 0-1.


***
  
# Methods
```{r setup, warning=FALSE, message=FALSE}

knitr::opts_chunk$set(eval=FALSE)

## load libraries, set directories
library(ohicore)  #devtools::install_github('ohi-science/ohicore@dev')
library(dplyr)
library(stringr)
library(tidyr)
library(zoo)  
library(ggplot2)
library(here)
library(tidyverse)
library(plotly)
library(readr)

## Load FAO-specific user-defined functions
source(here('workflow/R/fao_fxn.R')) # function for cleaning FAO files
source(here('workflow/R/common.R')) # directory locations
source(here('globalprep/np/v2020/R/np_fxn.R'))
source(here('globalprep/mar/v2020/mar_fxs.R')) # functions specific to mariculture dealing with compound countries

```

# Import Raw Data: FAO Mariculture data

Mariculture production in tonnes.

```{r}

mar <- read.csv(file.path(dir_M, 'git-annex/globalprep/_raw_data/FAO_mariculture/d2020/FAO_GlobalAquacultureProduction_Quantity_1950_2018.csv'), check.names=FALSE, stringsAsFactors=FALSE) ; head(mar) 

```

# Wrangle: 

## Tidy mariculture data

Filter freshwater mariculture, make long format, and clean FAO codes.

```{r}

mar <- mar %>%
  rename(country = `Country (Country)`,
         FAO_name = `ASFIS species (ASFIS species)`, 
         fao = `FAO major fishing area (FAO major fishing area)`, 
         environment = `Environment (Environment)`)
table(mar$environment)  

## Include only marine environments
mar <- mar %>%
filter(environment %in% c("Brackishwater", "Marine"))  

## Convert to long format and clean FAO codes:
mar <- mar %>%
  select(-Unit) 

mar <- mar %>%
  gather(key="year", value="value", num_range("",1950:2018)) %>%
    fao_clean_data() 

```

## Update seaweed species information

Filter out seaweed species from 'raw/species_list.csv' (originally from 'globalprep/mar/v2020/raw'), rename columns, and assign proportions to "include" column determined by research of non-human food vs human food seaweed species cultivated in mariculture. For NP, we are only including non-human food seaweed species. Since some species are used for both non-human food and human food purposes, a proportion is assigned based on research and best guess.

```{r}
#### NOTE: this is likely only necessary for the v2020 udpate. If any species are to be added, it will be done in the chunk below this one ####

## Read in 'species_list.csv' (originally from 'globalprep/mar/v2020/raw'). Filter for 'Taxon_code = AL' (only seaweed species). Rename 'exclude' columns to 'include' since we're now including seaweed species that were excluded in the MAR dataprep (not primarily used as human food). Therefore, "0" means exclude completely (0%), and "1" means include completely (100%). Four scenarios for comparison purposes: 1) "include" - best guess of non-human food species; 2) "include_no_food" - if species is used for human food at all, exclude it; 3) "include_all_seaweed" - including all seaweeds in NP goal (including seaweeds used primarily for human food), 4) "include_all_nei" - including all seaweeds not elsewhere included in the dataset.
seaweed_sp <- read.csv('raw/species_list.csv', stringsAsFactors=FALSE) %>% 
  filter(Taxon_code == 'AL') %>% 
  rename(include = exclude, 
         include_all_seaweed = exclude_no_seaweed, 
         include_all_nei = exclude_no_nei) %>% 
  mutate(include_no_food = include) %>% 
  dplyr::select(1:2, include_no_food, everything())
  
## Save in 'globalprep/np/v2020/raw' as 'species_list_np_seaweeds.csv'. Export and edit csv file directly to go through each species and confirm if appropriate to include in NP goal, adding to 'notes_2' column why each species is included/excluded and what proportion (with a reference).
write.csv(seaweed_sp,"raw/species_list_np_seaweeds.csv", row.names = FALSE)

```

Changes made to species_list_np_seaweeds.csv:

FAO_name                   | Change in "include" value | Explanation summary
-------------------------- | ------------------------- | -------------------
[Chondracanthus chamissoi] | 0 --> 0.8                 | Used in carrageenan
[Porphyra columbina]       | 0 --> 0.01                | Porphyra spp. are produced almost exclusively for direct human consumption
[Spirulina maxima]         | 0 --> 0.3                 | More than 70% of Spirulina market is for human consumption, mainly as health food
Aquatic plants nei         | no change (0)             | The important seaweeds for human consumption are already listed
Babberlocks                | no change (0)             | Only used for human food according to FAO
Bright green nori          | 0 --> 0.01                | Used for abalone feed
Dark green nori            | 0 --> 0.01                | Used for abalone feed
Sea lettuces nei           | 0 --> 0.5                 | Used for feed in aquarium trade
Brown seaweeds             | 0 --> 0.5                 | Main uses: food and alginate
Caulerpa seaweeds          | 0 --> 0.01                | Used for abalone feed
[Meristotheca senegalense] | no change (0)             | Only used for human food
Dulse                      | 0 --> 0.1                 | Found to be a valuable food for red abalone
Elkhorn sea moss           | 1 --> 0.99                | Primarily used to produce carrageenan, but also edible
Eucheuma seaweeds nei      | 1 --> 0.9                 | Also eaten raw in some countries
Fragile codium             | 1 --> 0.1                 | Medicinal uses
Fusiform sargassum         | no change (0)             | Only used for human food
Gelidium seaweeds          | 1 --> 0.8                 | Primarily used for agar, but also consumed as food
Giant kelp                 | 1 --> 0.9                 | Primarily used for alginate, but also consumed as food
Gracilaria seaweeds        | 1 --> 0.75                | Primarily used for agar, but also consumed as food (Ogo)
Green laver                | 0 --> 0.01                | Used for abalone feed
Harpoon seaweeds           | 1 --> 0.75                | Also used for human food (ingredient in poke)
Japanese isinglass         | 1 --> 0.95                | Primarily used for agar, but also consumed as food, especially in Korea
Japanese kelp              | 0 --> 0.1                 | Primarily used for human food (kombu), but also for alginate
Kelp nei                   | 1 --> 0.5                 | Main uses: food and alginate
Laver (Nori)               | 0 --> 0.01                | Used for abalone feed
Mozuku                     | 0 --> 0.01                | Used for homeopathic purposes
Nori nei                   | 0 --> 0.01                | Used for abalone feed
Red seaweeds               | 1 --> 0.75                | Main uses: food and 2 sources of hydrocolloids (agar and carrageenan)
Sea belt                   | 1 --> 0.95                | Primarily used for agar, but food market growing
Seaweeds nei               | 0 --> 0.15                | Most seaweeds are used for human food
Spiny eucheuma             | 1 --> 0.9                 | Primarily used for carrageenan, but also consumed as food
Tangle                     | 1 --> 0.99                | Primarily used for alginate, but also consumed as food
Wakame                     | 0 --> 0.01                | Used for abalone feed
Wakame nei                 | 0 --> 0.01                | Used for abalone feed
Warty gracilaria           | 1 --> 0.95                | Primarily used for agar, but increasingly used for abalone feed
Giant kelps nei            | 1 --> 0.9                 | Primarily used for alginate, but also consumed as food
Green seaweeds             | 1 --> 0.75                | Mixed non-food uses, but also consumed as food
Coarse seagrape            | no change (0)             | Only used for human food
[Sargassum spp]            | 1 --> 0.99                | Primarily used for alginate, but also consumed as food
Spirulina nei.             | 1 --> 0.3                 | More than 70% of Spirulina market is for human consumption, mainly as health food
[Dunaliella salina]        | no change (1)             | Used in cosmetics and dietary supplements
[Capsosiphon fulvescens]   | 1 --> 0.1                 | Used as traditional medicine
Slender wart weed          | 1 --> 0.75                | Primarily used for agar and fish feed, but also consumed as food

More detailed explanations are included in the "notes_2" column of species_list_np_seaweeds_edited.csv. 


## Update species names

Update species name in the `raw/species_list_np_seaweeds_edited.csv` file with names in the `mar` dataset. Simplified the species list and cut the "species" name columns because it wasn't clear what this was trying to accomplish and created potential error.  

```{r}

## Read in edited 'species_list_np_seaweeds_edited.csv'.
seaweeds <- read.csv('raw/species_list_np_seaweeds_edited.csv', stringsAsFactors = FALSE)

## Different versions of the dataset, representing the four different seaweed inclusion methods (include proportions of non-human food species, include only completely non-human food species, include all seaweeds, include all seaweeds nei). Use at the end for data checking. The first one is the one which is saved to the "output" folder. 
seaweeds_sp <- seaweeds %>%
  select(FAO_name, include, alias, Taxon_code, family)
# seaweeds_sp <- seaweeds %>%
#   select(FAO_name, include_no_food, alias, Taxon_code)
# seaweeds_sp <- seaweeds %>%
#   select(FAO_name, include_all_seaweed, alias, Taxon_code)
# seaweeds_sp <- seaweeds %>%
#   select(FAO_name, include_all_nei, alias, Taxon_code)

new.spp <- setdiff(mar$FAO_name, seaweeds_sp$FAO_name)
new.spp # check: if dim has 0 rows it means all match
# if there is a list of species, hand check species_list.csv to see whether to keep (include seaweeds and species harvested for ornamental/medicinal), check if synonyms match Trujillo names. 
# this is outlined in issue #8 and issue #81 for reference. You need to add the species output from this to species_list_np_seaweeds_edited.csv and fill out the corresponding information. I.e. add FAO_name, include (whether to include in assessment or not. If they are only harvested for human food purposes, do not include. Assign a proportion here), alias, and Taxon_code, and family to species_list_np_seaweeds_edited.csv.
# no seaweed species were listed - v2020

## REMOVE SPECIES not relevant to natural products goal (i.e., human food species)
seaweed_np <- seaweeds_sp %>% 
  left_join(mar, by="FAO_name") %>% 
  filter(include > 0)

unique(seaweed_np$FAO_name)
# went from 43 species to 39 species (4 completely human food species removed) - v2020
 
## Change names using species alias or FAO species name (global changes)
seaweed_np$species <- ifelse(!is.na(seaweed_np$alias), seaweed_np$alias, seaweed_np$FAO_name) 

## Sum production values for each group to account for duplicate rows after name change (remove NA values)
seaweed_np <- seaweed_np %>%
  filter(!is.na(value)) %>%
  group_by(country, fao, environment, species, year, Taxon_code, family, include) %>% 
    summarize(value = sum(value)) %>% 
  ungroup()

unique(seaweed_np$species)
# went from 39 species to 35 species (lost "Aquatic plants nei", "Bright green nori", "Kelp nei", "Giant kelps nei") due to no production values for those species - v2020
# went from 50 to 49 countries

## Eliminate country-species data with zero production throughout the time-series (1950-recent)
seaweed_np <- seaweed_np %>%
  group_by(country, species) %>%
  mutate(total_value = sum(value)) %>%
  filter(total_value > 0) %>%
  select(-total_value) %>%
  ungroup()

```

## Convert country names to OHI regions

```{r}

## Divide mariculture from countries that we report as separate regions (assume equal production in all regions)
# Netherlands Antilles: Conch restoration among Aruba, Bonaire, Curacao
# Channel Islands: Jersey and Guernsey
# Bonaire/S.Eustatius/Saba
# Yugoslavia SFR: no longer a country after 1992
seaweed_np <- seaweed_np %>%
  mutate(country = ifelse(country=="Réunion", "Reunion", country)) %>%  # this one is hard to get right; v2020: last year it was "R\xe9union", but this year it was "Réunion"
  mar_split()  # function in mar_fxs.R

mar_rgn <- name_2_rgn(df_in = seaweed_np, 
                       fld_name='country', 
                       flds_unique=c('species', 'fao', 'environment', 'Taxon_code', 'year', 'include')) 


## Sum values of regions with multiple subregions
mar_rgn <- mar_rgn %>%
  group_by(fao, environment, species, year, Taxon_code, family, rgn_id, include) %>% 
  summarize(value = sum(value)) %>%
  ungroup()
# went from 2979 to 2950 observations - v2020

```

**Take a look at the tidied data for a single year and region**

```{r}

data.frame(filter(mar_rgn, rgn_id==182) %>%
  filter(year==2016) %>%
  arrange(species))

```

# Gapfilling

## Fill in missing years after first year of harvest data with 0 values

Checked to make sure that there weren't instances in which it made more sense to carry the previous year's data forward as a method of gapfilling. This didn't seem to be the case.

```{r}

## Spread mar_rgn to create a value for every year-species-region (if missing it will be given a NA)
mar_rgn_spread <- spread(mar_rgn, year, value)
dim(mar_rgn_spread)

## Turn data frame back into long format
mar_rgn_gf <- gather(mar_rgn_spread, "year", "value", num_range("",1950:2018)) %>%
  arrange(rgn_id, species, year, Taxon_code, fao, environment) 

## NA values are converted to zero
mar_rgn_gf <- mar_rgn_gf %>%
  mutate(year = as.numeric(as.character(year))) %>%
  mutate(value_w_0 = ifelse(is.na(value), 0, value)) %>%
  group_by(fao, environment, species, Taxon_code, rgn_id) %>% 
  mutate(cum_value = cumsum(value_w_0)) %>%
  ungroup() %>%
  filter(cum_value > 0) %>% # eliminates years before mariculture began
  mutate(gap_0_fill = ifelse(is.na(value), "NA_to_zero", "0")) %>% # record gapfill
  mutate(value = ifelse(is.na(value), 0, value)) %>% # finally, convert all NAs in original column to 0
  select(-cum_value, -value_w_0)

```

See how may NA values were converted to 0

```{r}

table(mar_rgn_gf$gap_0_fill)
## 382 of these out of 2299+382 cases had NA converted to 0 - v2020

```

Remove species-region-environment time series with less than four years of seaweeed mariculture production > 0 tonnes (assume these are not established seaweed mariculture programs).

```{r}

mar_rgn_gf = mar_rgn_gf %>% 
  group_by(rgn_id, species, fao, environment) %>%
  mutate (not_0 = length(value[value>0])) %>% # length of vector of years greater than 0
  filter (not_0>3) %>% # filter for groups that have at least four years of seaweed mariculture production 
  ungroup() %>% 
  select(rgn_id, species, fao, environment, year, include, value, Taxon_code, gap_0_fill) 

```

Add a unique identifier per cultivated stock that describes each species, fao region, and environment grouping.

```{r}

## Add a unique identifier per cultivated stock
identifier = mar_rgn_gf %>% 
  select(rgn_id, species, fao, environment) %>% 
  unique() %>% 
  mutate(species_code = 1:n())
# 82 unique identifiers - v2020

mar_rgn_gf = left_join(mar_rgn_gf, identifier)
maric <- mar_rgn_gf

```

# Calculate and save tonnes of seaweed

Find the tonnes per each region/year per each seaweed type (multiplied by "include" proportions).

Used to estimate total seaweed mariculture yield per country.

```{r}

## Multiply "include" column by "value" column to find tonnes per region/year for each seaweed species
maric <- maric %>% 
  mutate(tonnes = include*value)

## Save in 'globalprep/np/v2020_new/int' as 'np_seaweeds_tonnes.csv' for weighting purposes later on
write.csv(maric,"int/np_seaweeds_tonnes_weighting.csv", row.names = FALSE)

```

# Sustainability Scores from Seafood Watch Data

## Import data: Seafood Watch sustainability scores

These data describe the sustainability country/species combinations. In cases where these data were not available for a specific county/species, we just used the seafood watch seaweed sustainability score (7.92) (this was all of the seaweed species listed). 

```{r sw-scores, eval = FALSE}

## Load in Seafood Watch sustainability scores data from mazu:
sw_sus <- read.csv(file.path(dir_M, 'git-annex/globalprep/_raw_data/seafood_watch_mar_sustainability/d2020/Seafood-Watch_aquaculture-recs_July-2020.csv'), check.names = FALSE, stringsAsFactors = FALSE, na.strings = c("NA", ""))

head(sw_sus)

```

## Wrangle

### Tidy Seafood Watch sustainability data

Rename columns to match with MAR data and fill in species column

```{r tidy_sw-sus, eval = FALSE}

## Rename columns
sw_sus <- sw_sus %>%
  rename(report_title = 'Report Title',
         start_year = 'Start year',
         sw_species = 'Common name',
         genus = 'Genus',
         spp = 'Species',
         fao_species = 'FAO Common name',
         region = 'Region',
         country = 'Country',
         state_territory = 'State/Territory',
         sub_region = 'Sub-Region',
         water_body = 'Body of Water',
         parent_method = 'Parent Method',
         method = 'Method',
         score = 'Overall Score',
         escapes_score = 'AqCriteria6',
         rec = 'Overall Recommendation'
         ) %>% 
  dplyr::select(report_title, start_year, sw_species, genus, spp, fao_species, region, country, state_territory, sub_region, water_body, parent_method, method, escapes_score, score, rec)

## Change species names using FAO species name (fao_species); if NA, use common name (sw_species)
sw_sus$species <- ifelse(!is.na(sw_sus$fao_species), sw_sus$fao_species, sw_sus$sw_species)

```

### Keep NA countries

```{r keep-na-countries_sw-sus, eval = FALSE}

## These need to be re-added later (get cut when associated with region ids)
sw_sus_no_rgn <- filter(sw_sus, is.na(country))
  # 203 entries with no country

```

### Convert country names to OHI region IDs.

```{r sw-sus_convert-region, eval = FALSE}

## Change country names to match OHI region names
sw_sus <- sw_sus %>% 
  mutate(country = ifelse(country=="Korea, the Republic of", "South Korea", country)) %>% # Data removed for not having a match; change name to match
  mutate(country = ifelse(country=="United Kingdom of Great Britain and Northern Ireland (the)", "United Kingdom", country))  # Data removed for not having a match; change name to match

## Convert country names to OHI region IDs. (ohicore/R/name_2_rgn.R)
sw_sus_rgn <- name_2_rgn(df_in = sw_sus, 
                       fld_name='country', 
                       flds_unique=c('fao_species', 'sw_species', 'region', 'score'),
                       keep_fld_name = TRUE) # 'country' now shows the original Seafood Watch data name; 'rgn_name' is what we want to use from now on
  # Goes from 330 obs. to 127 obs. (because 203 obs. have no country associated)


## Re-add NA countries
sw_sus_rgn <- bind_rows(sw_sus_rgn, sw_sus_no_rgn) %>%
  unique()
  # Back to 330 obs.

```

**Check that the non-matches between Seafood Watch sustainability data species (sw_sus_rgn) and the FAO mariculture species in the wrangled FAO Aquaculture Production data table (maric) are not due to spelling errors or slightly different names. We want to include as many species that have sustainability scores as possible**

```{r sw-sus_check-non-matches, eval = FALSE}

## Make sure same species are spelled the same in the two data tables (e.g. check that there are no extra spaces)
sort(setdiff(sw_sus_rgn$species, maric$species)) # Seafood Watch species with no FAO data

sort(setdiff(maric$species, sw_sus_rgn$species)) # FAO species with no Seafood Watch data - there will probably be a long list

## Hand check each of the species output here. I mainly check to make sure there aren't obvious cases when the species is the same, but the names are presented slightly differently in the lists. For example, some species might have an extra space in the name somewhere. If any of these obvious differences exist, we need to go in and change the names to match. 
## Its not too surprising (unfortunately) that the FAO list has far more species than the sustainability list. But, I like to go over them to make sure that we are getting sustainability scores for as many species as we can.

```

**Fix the non matches**
```{r sw-sus_fix-non-matches, eval = FALSE}
## This will likely be the same as in the MAR prep. 

## Rename species in Seafood Watch data to match FAO species data
sw_sus_rgn$species <- gsub("Abalone", "Abalones nei", sw_sus_rgn$species)
sw_sus_rgn$species <- gsub("Barramundi", "Barramundi(=Giant seaperch)", sw_sus_rgn$species)
sw_sus_rgn$species <- gsub("Coho salmon", "Coho(=Silver) salmon", sw_sus_rgn$species)
sw_sus_rgn$species <- gsub("Manila clam", "Japanese carpet shell", sw_sus_rgn$species) # Japanese carpet shell is another name for Manila clam (thanks animal crossing :P )
sw_sus_rgn$species <- gsub("New Zealand Mussel", "New Zealand mussel", sw_sus_rgn$species)
sw_sus_rgn$species <- gsub("Hard clam (unspecified)", "Northern quahog(=Hard clam)", sw_sus_rgn$species) # Hard clams are also known as quahogs, round clams, or hard-shell clams
sw_sus_rgn$species <- gsub("Common sole", "[Solea spp]", sw_sus_rgn$species)

```

**Join the seaweed sustainability data with the mariculture data**
```{r sw-fao-joining, eval = FALSE}
mar_sw_sus <- maric %>%
  left_join(sw_sus_rgn, by = c("species", "rgn_id")) %>%
  dplyr::select(rgn_id, year, species, Taxon_code, species_code, score, tonnes, gap_0_fill )
```


**Since there are no sustainability scores for any of the species listed, we will gapfill with the seafood watch "Seaweed (Global)" score, which is 7.92.**
```{r}
mar_sw_sus <- mar_sw_sus %>%
  mutate(Sust = round(7.92/10,2)) %>%
  dplyr::select(-score)
```


Since some regions have multiple sustainability scores for the same species due to multiple aquaculture methods, but we don't know what proportions of which methods are used, we take the average of the sustainability scores in these instances.

Average sustainability scores within regions with more than score (due to more than one aquaculture method):

```{r sw-sus-avg, eval = FALSE}

mar_sw_sus <- mar_sw_sus %>% 
  dplyr::group_by(rgn_id, species) %>% 
  dplyr::mutate(Sust_avg = mean(Sust, na.rm=TRUE)) %>% 
  dplyr::ungroup()


```

Get rid of duplicates for region/species/year:

```{r sw-sus-dup, eval = FALSE}

mar_sw_sus <- mar_sw_sus %>% 
  dplyr::distinct(rgn_id, species, year, .keep_all = TRUE) %>%
  dplyr::select(-Sust, sust_coeff = Sust_avg, taxon_group = Taxon_code) %>%
  mutate(taxa_code = paste(species, species_code, sep="_"))

```

**Now look at a summary after appending all the Seafood Watch data**

```{r sw-sus-summary, eval = FALSE}

summary(mar_sw_sus)
# No NAs in Sust! 

```

# Save Data:

```{r}


## save seaweed mariculture sustainability dataset
seaweed_sust <- mar_sw_sus %>%
  dplyr::select(rgn_id, taxa_code, year, sust_coeff)

write_csv(seaweed_sust, "output/np_seaweed_sust.csv")


## Save seaweed mariculture harvest tonnes data ("tonnes" column already incorporated include proportions)
seaweed_harvest_tonnes <- mar_sw_sus %>%
  dplyr::select(rgn_id, taxa_code, year, tonnes)

anyDuplicated(seaweed_harvest_tonnes) # check for duplication

write.csv(seaweed_harvest_tonnes, 'output/np_seaweed_harvest_tonnes.csv', row.names=F)

```

## Save gapfill datasets 
```{r}
	
 
## save a gapfill dataset for FAO tonnes data:
 
mar_FAO_gf <- mar_sw_sus %>% 
  rename("gapfill_fao" = "gap_0_fill") %>%
  mutate(method = ifelse(gapfill_fao == 0, "none", gapfill_fao), 
         gapfilled = ifelse(gapfill_fao == 0, 0, 1)) %>%
  dplyr::select(rgn_id, taxa_code, year, gapfilled, method)
 
write.csv(mar_FAO_gf, "output/np_seaweed_harvest_tonnes_gf.csv", row.names = FALSE)


 
## save a gapfill dataset for sustainability dataset
 
mar_sust_gf <- mar_sw_sus %>%
  mutate(method = "sfw_seaweed_score",
         gapfilled = 1) %>%
  dplyr::select(rgn_id, year, taxa_code, gapfilled, method)
 
write.csv(mar_sust_gf, "output/np_seaweed_sust_gf.csv", row.names = FALSE)
```

